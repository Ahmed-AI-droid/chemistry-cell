<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… - Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-section {
            margin: 2rem 0;
            padding: 2rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--background-light);
        }
        .test-button {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }
        .test-button:hover {
            background: var(--primary-dark);
        }
        .stats-display {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .stat-value {
            font-weight: bold;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</h1>
            <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¸Ø§Ø¦Ù Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ¬Ø¯Ø¯Ø©</p>
        </header>

        <main class="main">
            <!-- Ù‚Ø³Ù… ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            <div class="test-section">
                <h2>ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                <button class="test-button" onclick="initDatabase()">ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button class="test-button" onclick="addSampleData()">Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
                <button class="test-button" onclick="clearDatabase()">Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <div id="init-status"></div>
            </div>

            <!-- Ù‚Ø³Ù… Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø© -->
            <div class="test-section">
                <h2>Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                <button class="test-button" onclick="simulateLesson()">Ø¥ÙƒÙ…Ø§Ù„ Ø¯Ø±Ø³ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
                <button class="test-button" onclick="simulateExercise()">Ø­Ù„ ØªÙ…Ø±ÙŠÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
                <button class="test-button" onclick="simulateLogin()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
                <button class="test-button" onclick="simulateMultipleActivities()">Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù†Ø´Ø·Ø© Ù…ØªØ¹Ø¯Ø¯Ø©</button>
                <div id="activity-status"></div>
            </div>

            <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="test-section">
                <h2>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</h2>
                <button class="test-button" onclick="refreshStats()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                <button class="test-button" onclick="showUserStats()">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯</button>
                
                <div class="stats-display" id="general-stats">
                    <h3>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                    <div id="general-stats-content">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                </div>

                <div class="stats-display" id="user-stats">
                    <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (student1)</h3>
                    <div id="user-stats-content">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
            <div class="test-section">
                <h2>Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h2>
                <button class="test-button" onclick="startAutoUpdate()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
                <button class="test-button" onclick="stopAutoUpdate()">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
                <div id="auto-update-status"></div>
            </div>
        </main>
    </div>

    <script src="database.js"></script>
    <script src="script.js"></script>
    <script>
        let autoUpdateInterval = null;

        // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function initDatabase() {
            const status = document.getElementById('init-status');
            status.innerHTML = '<p style="color: blue;">Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>';
            
            try {
                await window.educationDB.init();
                status.innerHTML = '<p style="color: green;">âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</p>';
            } catch (error) {
                status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: ${error.message}</p>`;
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        async function addSampleData() {
            const status = document.getElementById('init-status');
            status.innerHTML = '<p style="color: blue;">Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...</p>';
            
            try {
                await window.dbUtils.initializeWithSampleData();
                status.innerHTML = '<p style="color: green;">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</p>';
            } catch (error) {
                status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</p>`;
            }
        }

        // Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function clearDatabase() {
            const status = document.getElementById('init-status');
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                try {
                    indexedDB.deleteDatabase('EducationPlatformDB');
                    status.innerHTML = '<p style="color: orange;">ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                } catch (error) {
                    status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³Ø­: ${error.message}</p>`;
                }
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø¯Ø±Ø³
        async function simulateLesson() {
            const status = document.getElementById('activity-status');
            const students = ['student1', 'student2', 'student3', 'student4', 'student5'];
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            const lessonId = `lesson_${Math.floor(Math.random() * 10) + 1}`;
            
            try {
                await window.dbUtils.completeLesson(randomStudent, lessonId);
                status.innerHTML = `<p style="color: green;">âœ… ${randomStudent} Ø£ÙƒÙ…Ù„ ${lessonId}</p>`;
            } catch (error) {
                status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ù„ ØªÙ…Ø±ÙŠÙ†
        async function simulateExercise() {
            const status = document.getElementById('activity-status');
            const students = ['student1', 'student2', 'student3', 'student4', 'student5'];
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            const exerciseId = `exercise_${Math.floor(Math.random() * 5) + 1}`;
            const score = Math.floor(Math.random() * 40) + 60;
            
            try {
                await window.dbUtils.completeExercise(randomStudent, exerciseId, score);
                status.innerHTML = `<p style="color: green;">âœ… ${randomStudent} Ø­Ù„ ${exerciseId} ÙˆØ­ØµÙ„ Ø¹Ù„Ù‰ ${score}%</p>`;
            } catch (error) {
                status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
        async function simulateLogin() {
            const status = document.getElementById('activity-status');
            const students = ['student1', 'student2', 'student3', 'student4', 'student5'];
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            
            try {
                await window.educationDB.logSession(randomStudent, Math.floor(Math.random() * 120) + 30);
                status.innerHTML = `<p style="color: green;">âœ… ${randomStudent} Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¬Ø¯ÙŠØ¯</p>`;
            } catch (error) {
                status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù†Ø´Ø·Ø© Ù…ØªØ¹Ø¯Ø¯Ø©
        async function simulateMultipleActivities() {
            const status = document.getElementById('activity-status');
            status.innerHTML = '<p style="color: blue;">Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù†Ø´Ø·Ø© Ù…ØªØ¹Ø¯Ø¯Ø©...</p>';
            
            try {
                // Ù…Ø­Ø§ÙƒØ§Ø© 10 Ø£Ù†Ø´Ø·Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                for (let i = 0; i < 10; i++) {
                    const activity = Math.floor(Math.random() * 3);
                    if (activity === 0) await simulateLesson();
                    else if (activity === 1) await simulateExercise();
                    else await simulateLogin();
                    
                    // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ø£Ù†Ø´Ø·Ø©
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                status.innerHTML = '<p style="color: green;">âœ… ØªÙ… Ø¥Ù†Ø¬Ø§Ø² 10 Ø£Ù†Ø´Ø·Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</p>';
            } catch (error) {
                status.innerHTML = `<p style="color: red;">âŒ Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function refreshStats() {
            try {
                const generalStats = await window.dbUtils.getUpdatedStats();
                const content = document.getElementById('general-stats-content');
                
                content.innerHTML = `
                    <div class="stat-item">
                        <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨:</span>
                        <span class="stat-value">${generalStats.totalStudents}</span>
                    </div>
                    <div class="stat-item">
                        <span>Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†:</span>
                        <span class="stat-value">${generalStats.activeStudents}</span>
                    </div>
                    <div class="stat-item">
                        <span>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                        <span class="stat-value">${generalStats.successRate}%</span>
                    </div>
                    <div class="stat-item">
                        <span>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±:</span>
                        <span class="stat-value">${generalStats.attendanceRate}%</span>
                    </div>
                    <div class="stat-item">
                        <span>Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©:</span>
                        <span class="stat-value">${generalStats.totalCourses}</span>
                    </div>
                `;
            } catch (error) {
                document.getElementById('general-stats-content').innerHTML = `<p style="color: red;">Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯
        async function showUserStats() {
            try {
                const userStats = await window.dbUtils.getUserStats('student1');
                const content = document.getElementById('user-stats-content');
                
                if (userStats) {
                    content.innerHTML = `
                        <div class="stat-item">
                            <span>Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>
                            <span class="stat-value">${userStats.completedLessons}</span>
                        </div>
                        <div class="stat-item">
                            <span>Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©:</span>
                            <span class="stat-value">${userStats.completedExercises}</span>
                        </div>
                        <div class="stat-item">
                            <span>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…:</span>
                            <span class="stat-value">${userStats.averageScore}%</span>
                        </div>
                        <div class="stat-item">
                            <span>ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ù„Ù…:</span>
                            <span class="stat-value">${userStats.totalStudyTime} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>';
                }
            } catch (error) {
                document.getElementById('user-stats-content').innerHTML = `<p style="color: red;">Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function startAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
            }
            
            autoUpdateInterval = setInterval(async () => {
                await simulateExercise();
                await refreshStats();
                await showUserStats();
            }, 3000);
            
            document.getElementById('auto-update-status').innerHTML = '<p style="color: green;">ğŸ”„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù†Ø´Ø· (ÙƒÙ„ 3 Ø«ÙˆØ§Ù†)</p>';
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function stopAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
                autoUpdateInterval = null;
            }
            document.getElementById('auto-update-status').innerHTML = '<p style="color: orange;">â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>';
        }

        // ØªÙ‡ÙŠØ¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', async function() {
            await initDatabase();
            setTimeout(async () => {
                await addSampleData();
                await refreshStats();
                await showUserStats();
            }, 1000);
        });
    </script>
</body>
</html>

